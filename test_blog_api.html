<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢ API æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #0066FF;
        }
        .test-section h2 {
            margin-top: 0;
            color: #0066FF;
        }
        button {
            background: #0066FF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #0052CC;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.success {
            background: #28a745;
            color: white;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        .status.pending {
            background: #ffc107;
            color: #333;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 8px;
            font-family: inherit;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: 500;
            color: #333;
        }
        .test-blog-form {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ åšå®¢ API æµ‹è¯•å·¥å…·</h1>
        
        <!-- æµ‹è¯• 1: æ£€æŸ¥ API è¿æ¥ -->
        <div class="test-section">
            <h2>æµ‹è¯• 1: æ£€æŸ¥ API è¿æ¥ <span id="status1" class="status pending">å¾…æµ‹è¯•</span></h2>
            <p>æµ‹è¯• API ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®</p>
            <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>
        
        <!-- æµ‹è¯• 2: è·å–åšå®¢åˆ—è¡¨ -->
        <div class="test-section">
            <h2>æµ‹è¯• 2: è·å–åšå®¢åˆ—è¡¨ <span id="status2" class="status pending">å¾…æµ‹è¯•</span></h2>
            <p>ä»æœåŠ¡å™¨è·å–æ‰€æœ‰åšå®¢</p>
            <button onclick="testGetBlogs()">è·å–åšå®¢</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>
        
        <!-- æµ‹è¯• 3: åˆ›å»ºæµ‹è¯•åšå®¢ -->
        <div class="test-section">
            <h2>æµ‹è¯• 3: åˆ›å»ºæµ‹è¯•åšå®¢ <span id="status3" class="status pending">å¾…æµ‹è¯•</span></h2>
            <p>åˆ›å»ºä¸€æ¡æµ‹è¯•åšå®¢è®°å½•</p>
            <div class="test-blog-form">
                <label>æ ‡é¢˜:</label>
                <input type="text" id="testTitle" value="æµ‹è¯•åšå®¢ - " placeholder="è¾“å…¥åšå®¢æ ‡é¢˜">
                
                <label>æ—¥æœŸ:</label>
                <input type="text" id="testDate" value="" placeholder="YYYY-MM-DD">
                
                <label>å†…å®¹ (Markdown):</label>
                <textarea id="testContent" placeholder="è¾“å…¥åšå®¢å†…å®¹ï¼ˆæ”¯æŒ Markdownï¼‰"># æµ‹è¯•åšå®¢

è¿™æ˜¯ä¸€æ¡**æµ‹è¯•åšå®¢**è®°å½•ï¼Œç”¨äºéªŒè¯ API åŠŸèƒ½ã€‚

## åŠŸèƒ½æµ‹è¯•

- âœ… åˆ›å»ºåšå®¢
- âœ… ä¿å­˜åˆ°æœåŠ¡å™¨
- âœ… åœ¨çº¿åŒæ­¥

*åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString('zh-CN')}*</textarea>
            </div>
            <button onclick="testCreateBlog()">åˆ›å»ºæµ‹è¯•åšå®¢</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>
        
        <!-- æµ‹è¯• 4: éªŒè¯åšå®¢å·²ä¿å­˜ -->
        <div class="test-section">
            <h2>æµ‹è¯• 4: éªŒè¯åšå®¢å·²ä¿å­˜ <span id="status4" class="status pending">å¾…æµ‹è¯•</span></h2>
            <p>é‡æ–°è·å–åšå®¢åˆ—è¡¨ï¼Œç¡®è®¤æ–°åšå®¢å·²ä¿å­˜</p>
            <button onclick="testVerifyBlog()">éªŒè¯ä¿å­˜</button>
            <div id="result4" class="result" style="display: none;"></div>
        </div>
        
        <!-- å®Œæ•´æµ‹è¯•æµç¨‹ -->
        <div class="test-section">
            <h2>å®Œæ•´æµ‹è¯•æµç¨‹</h2>
            <p>è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæŒ‰é¡ºåºï¼‰</p>
            <button onclick="runAllTests()" style="background: #28a745;">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="resultAll" class="result" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        const API_URL = '/api/blogs';
        
        // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
        document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
        
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = message;
        }
        
        function updateStatus(statusId, status) {
            const element = document.getElementById(statusId);
            element.className = `status ${status}`;
            element.textContent = status === 'success' ? 'âœ“ æˆåŠŸ' : status === 'error' ? 'âœ— å¤±è´¥' : 'å¾…æµ‹è¯•';
        }
        
        async function testConnection() {
            updateStatus('status1', 'pending');
            showResult('result1', 'æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'OPTIONS',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok || response.status === 200) {
                    updateStatus('status1', 'success');
                    showResult('result1', `âœ… API è¿æ¥æˆåŠŸï¼\nçŠ¶æ€ç : ${response.status}\nURL: ${API_URL}`, 'success');
                } else {
                    updateStatus('status1', 'error');
                    showResult('result1', `âŒ API è¿æ¥å¤±è´¥\nçŠ¶æ€ç : ${response.status}\nçŠ¶æ€æ–‡æœ¬: ${response.statusText}`, 'error');
                }
            } catch (error) {
                updateStatus('status1', 'error');
                showResult('result1', `âŒ è¿æ¥é”™è¯¯:\n${error.message}\n\nå¯èƒ½çš„åŸå› :\n1. API ç«¯ç‚¹ä¸å­˜åœ¨\n2. æœåŠ¡å™¨æœªè¿è¡Œ\n3. CORS é…ç½®é—®é¢˜`, 'error');
            }
        }
        
        async function testGetBlogs() {
            updateStatus('status2', 'pending');
            showResult('result2', 'æ­£åœ¨è·å–åšå®¢åˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const blogs = data.blogs || [];
                    updateStatus('status2', 'success');
                    showResult('result2', `âœ… æˆåŠŸè·å–åšå®¢åˆ—è¡¨ï¼\n\nåšå®¢æ•°é‡: ${blogs.length}\n\nåšå®¢åˆ—è¡¨:\n${JSON.stringify(blogs, null, 2)}`, 'success');
                } else {
                    const errorData = await response.json().catch(() => ({ error: response.statusText }));
                    updateStatus('status2', 'error');
                    showResult('result2', `âŒ è·å–åšå®¢å¤±è´¥\nçŠ¶æ€ç : ${response.status}\né”™è¯¯ä¿¡æ¯:\n${JSON.stringify(errorData, null, 2)}`, 'error');
                }
            } catch (error) {
                updateStatus('status2', 'error');
                showResult('result2', `âŒ è·å–åšå®¢æ—¶å‡ºé”™:\n${error.message}`, 'error');
            }
        }
        
        async function testCreateBlog() {
            updateStatus('status3', 'pending');
            const title = document.getElementById('testTitle').value.trim();
            const date = document.getElementById('testDate').value;
            const content = document.getElementById('testContent').value.trim();
            
            if (!title || !date || !content) {
                updateStatus('status3', 'error');
                showResult('result3', 'âŒ è¯·å¡«å†™æ‰€æœ‰å­—æ®µï¼ˆæ ‡é¢˜ã€æ—¥æœŸã€å†…å®¹ï¼‰', 'error');
                return;
            }
            
            showResult('result3', 'æ­£åœ¨åˆ›å»ºæµ‹è¯•åšå®¢...', 'info');
            
            try {
                // å…ˆè·å–ç°æœ‰åšå®¢
                const getResponse = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                let blogs = [];
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    blogs = data.blogs || [];
                }
                
                // åˆ›å»ºæ–°åšå®¢
                const newBlog = {
                    id: Date.now(),
                    title: title,
                    date: date,
                    content: content
                };
                
                blogs.push(newBlog);
                
                // ä¿å­˜åˆ°æœåŠ¡å™¨
                const saveResponse = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ blogs: blogs })
                });
                
                if (saveResponse.ok) {
                    updateStatus('status3', 'success');
                    showResult('result3', `âœ… æµ‹è¯•åšå®¢åˆ›å»ºæˆåŠŸï¼\n\nåšå®¢ä¿¡æ¯:\n${JSON.stringify(newBlog, null, 2)}\n\nå·²ä¿å­˜åˆ°æœåŠ¡å™¨`, 'success');
                } else {
                    const errorData = await saveResponse.json().catch(() => ({ error: saveResponse.statusText }));
                    updateStatus('status3', 'error');
                    showResult('result3', `âŒ ä¿å­˜åšå®¢å¤±è´¥\nçŠ¶æ€ç : ${saveResponse.status}\né”™è¯¯ä¿¡æ¯:\n${JSON.stringify(errorData, null, 2)}`, 'error');
                }
            } catch (error) {
                updateStatus('status3', 'error');
                showResult('result3', `âŒ åˆ›å»ºåšå®¢æ—¶å‡ºé”™:\n${error.message}`, 'error');
            }
        }
        
        async function testVerifyBlog() {
            updateStatus('status4', 'pending');
            showResult('result4', 'æ­£åœ¨éªŒè¯åšå®¢æ˜¯å¦å·²ä¿å­˜...', 'info');
            
            try {
                // ç­‰å¾…1ç§’ï¼Œç¡®ä¿æœåŠ¡å™¨å·²æ›´æ–°
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const blogs = data.blogs || [];
                    
                    // æŸ¥æ‰¾æµ‹è¯•åšå®¢ï¼ˆæ ‡é¢˜åŒ…å«"æµ‹è¯•åšå®¢"ï¼‰
                    const testBlogs = blogs.filter(blog => 
                        blog.title && blog.title.includes('æµ‹è¯•åšå®¢')
                    );
                    
                    if (testBlogs.length > 0) {
                        updateStatus('status4', 'success');
                        showResult('result4', `âœ… éªŒè¯æˆåŠŸï¼æ‰¾åˆ° ${testBlogs.length} æ¡æµ‹è¯•åšå®¢\n\næµ‹è¯•åšå®¢åˆ—è¡¨:\n${JSON.stringify(testBlogs, null, 2)}`, 'success');
                    } else {
                        updateStatus('status4', 'error');
                        showResult('result4', `âš ï¸ æœªæ‰¾åˆ°æµ‹è¯•åšå®¢\n\nå½“å‰åšå®¢æ€»æ•°: ${blogs.length}\næ‰€æœ‰åšå®¢:\n${JSON.stringify(blogs, null, 2)}`, 'error');
                    }
                } else {
                    const errorData = await response.json().catch(() => ({ error: response.statusText }));
                    updateStatus('status4', 'error');
                    showResult('result4', `âŒ éªŒè¯å¤±è´¥\nçŠ¶æ€ç : ${response.status}\né”™è¯¯ä¿¡æ¯:\n${JSON.stringify(errorData, null, 2)}`, 'error');
                }
            } catch (error) {
                updateStatus('status4', 'error');
                showResult('result4', `âŒ éªŒè¯æ—¶å‡ºé”™:\n${error.message}`, 'error');
            }
        }
        
        async function runAllTests() {
            showResult('resultAll', 'å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹...\n\n', 'info');
            
            // æµ‹è¯• 1: è¿æ¥
            updateStatus('status1', 'pending');
            await testConnection();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // æµ‹è¯• 2: è·å–åšå®¢
            updateStatus('status2', 'pending');
            await testGetBlogs();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // æµ‹è¯• 3: åˆ›å»ºåšå®¢
            updateStatus('status3', 'pending');
            document.getElementById('testTitle').value = `æµ‹è¯•åšå®¢ - ${new Date().toLocaleString('zh-CN')}`;
            await testCreateBlog();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // æµ‹è¯• 4: éªŒè¯åšå®¢
            updateStatus('status4', 'pending');
            await testVerifyBlog();
            
            // æ±‡æ€»ç»“æœ
            const status1 = document.getElementById('status1').className.includes('success');
            const status2 = document.getElementById('status2').className.includes('success');
            const status3 = document.getElementById('status3').className.includes('success');
            const status4 = document.getElementById('status4').className.includes('success');
            
            const allPassed = status1 && status2 && status3 && status4;
            
            showResult('resultAll', 
                `å®Œæ•´æµ‹è¯•å®Œæˆï¼\n\n` +
                `æµ‹è¯• 1 (è¿æ¥): ${status1 ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n` +
                `æµ‹è¯• 2 (è·å–): ${status2 ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n` +
                `æµ‹è¯• 3 (åˆ›å»º): ${status3 ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n` +
                `æµ‹è¯• 4 (éªŒè¯): ${status4 ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n\n` +
                `${allPassed ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼API å·¥ä½œæ­£å¸¸ã€‚' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯ã€‚'}`,
                allPassed ? 'success' : 'error'
            );
        }
    </script>
</body>
</html>

