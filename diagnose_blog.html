<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢ API è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        button {
            background: #0066FF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
        }
        button:hover {
            background: #0052CC;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 600px;
            overflow-y: auto;
            background: #f9f9f9;
            border: 1px solid #ddd;
        }
        .result.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” åšå®¢ API è¯Šæ–­å·¥å…·</h1>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è¿è¡Œå®Œæ•´è¯Šæ–­ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„è¯Šæ–­ç»“æœã€‚</p>
        <button onclick="runDiagnosis()">å¼€å§‹è¯Šæ–­</button>
        <div id="result" class="result" style="display: none;"></div>
    </div>
    
    <script>
        async function runDiagnosis() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨è¯Šæ–­...\n\n';
            
            let output = 'ğŸ” å¼€å§‹è¯Šæ–­åšå®¢ API...\n\n';
            
            // 1. æ£€æŸ¥ API URL
            const apiUrl = '/api/blogs';
            output += '1ï¸âƒ£ API URL: ' + apiUrl + '\n\n';
            
            // 2. æµ‹è¯• API è¿æ¥
            output += '2ï¸âƒ£ æµ‹è¯• API è¿æ¥...\n';
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                output += '   çŠ¶æ€ç : ' + response.status + '\n';
                output += '   çŠ¶æ€æ–‡æœ¬: ' + response.statusText + '\n';
                
                if (response.ok) {
                    const data = await response.json();
                    output += '   âœ… API è¿æ¥æˆåŠŸï¼\n';
                    output += '   åšå®¢æ•°é‡: ' + (data.blogs?.length || 0) + '\n';
                    if (data.blogs && data.blogs.length > 0) {
                        output += '   åšå®¢åˆ—è¡¨:\n';
                        data.blogs.forEach((blog, index) => {
                            output += `      ${index + 1}. ID: ${blog.id}, æ ‡é¢˜: ${blog.title || '(æ— æ ‡é¢˜)'}\n`;
                        });
                    }
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    output += '   âŒ API è¿”å›é”™è¯¯\n';
                    output += '   é”™è¯¯å†…å®¹: ' + errorText.substring(0, 500) + '\n';
                    
                    try {
                        const errorData = JSON.parse(errorText);
                        output += '   é”™è¯¯è¯¦æƒ…: ' + JSON.stringify(errorData, null, 2) + '\n';
                    } catch (e) {
                        output += '   æ— æ³•è§£æé”™è¯¯ JSON\n';
                    }
                    
                    // æ ¹æ®çŠ¶æ€ç æä¾›å»ºè®®
                    if (response.status === 404) {
                        output += '\n   ğŸ’¡ å»ºè®®: API ç«¯ç‚¹ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥:\n';
                        output += '      - api/blogs.js æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n';
                        output += '      - Vercel æ˜¯å¦å·²æ­£ç¡®éƒ¨ç½²\n';
                    } else if (response.status === 500) {
                        output += '\n   ğŸ’¡ å»ºè®®: æœåŠ¡å™¨é”™è¯¯ï¼Œå¯èƒ½çš„åŸå› :\n';
                        output += '      - GitHub Token æˆ– Gist ID æœªé…ç½®\n';
                        output += '      - GitHub API è°ƒç”¨å¤±è´¥\n';
                        output += '      - æ£€æŸ¥ Vercel Functions æ—¥å¿—\n';
                    } else if (response.status === 401 || response.status === 403) {
                        output += '\n   ğŸ’¡ å»ºè®®: è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥:\n';
                        output += '      - GitHub Token æ˜¯å¦æœ‰æ•ˆ\n';
                        output += '      - Token æ˜¯å¦æœ‰ gist æƒé™\n';
                        output += '      - Gist ID æ˜¯å¦æ­£ç¡®\n';
                    }
                    
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                output += '   âŒ ç½‘ç»œé”™è¯¯: ' + error.message + '\n';
                output += '   é”™è¯¯ç±»å‹: ' + error.name + '\n';
                if (error.stack) {
                    output += '   é”™è¯¯å †æ ˆ: ' + error.stack.substring(0, 300) + '\n';
                }
                output += '\n   ğŸ’¡ å»ºè®®: ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œå¯èƒ½çš„åŸå› :\n';
                output += '      - API ç«¯ç‚¹ä¸å­˜åœ¨\n';
                output += '      - æœåŠ¡å™¨æœªè¿è¡Œ\n';
                output += '      - CORS é…ç½®é—®é¢˜\n';
                output += '      - ç½‘ç»œè¿æ¥é—®é¢˜\n';
                resultDiv.className = 'result error';
            }
            
            // 3. æ£€æŸ¥æœ¬åœ°å­˜å‚¨
            output += '\n3ï¸âƒ£ æ£€æŸ¥æœ¬åœ°å­˜å‚¨...\n';
            const localBlogs = localStorage.getItem('blogs');
            if (localBlogs) {
                try {
                    const blogs = JSON.parse(localBlogs);
                    output += '   âœ… æœ¬åœ°å­˜å‚¨æœ‰æ•°æ®\n';
                    output += '   åšå®¢æ•°é‡: ' + blogs.length + '\n';
                    if (blogs.length > 0) {
                        output += '   åšå®¢åˆ—è¡¨:\n';
                        blogs.forEach((blog, index) => {
                            output += `      ${index + 1}. ID: ${blog.id}, æ ‡é¢˜: ${blog.title || '(æ— æ ‡é¢˜)'}\n`;
                        });
                    }
                } catch (e) {
                    output += '   âŒ æœ¬åœ°å­˜å‚¨æ•°æ®æ ¼å¼é”™è¯¯: ' + e.message + '\n';
                }
            } else {
                output += '   âš ï¸ æœ¬åœ°å­˜å‚¨æ— æ•°æ®\n';
            }
            
            // 4. æ£€æŸ¥ DOM å…ƒç´ 
            output += '\n4ï¸âƒ£ æ£€æŸ¥ DOM å…ƒç´ ...\n';
            const blogList = document.getElementById('blogList');
            if (blogList) {
                output += '   âœ… blogList å…ƒç´ å­˜åœ¨\n';
                output += '   å½“å‰å†…å®¹é•¿åº¦: ' + blogList.innerHTML.length + ' å­—ç¬¦\n';
                if (blogList.innerHTML.length > 0) {
                    output += '   å‰100ä¸ªå­—ç¬¦: ' + blogList.innerHTML.substring(0, 100) + '...\n';
                }
            } else {
                output += '   âŒ blogList å…ƒç´ ä¸å­˜åœ¨ï¼\n';
                output += '   ğŸ’¡ è¯·æ£€æŸ¥ index.html ä¸­æ˜¯å¦æœ‰ <div id="blogList"></div>\n';
            }
            
            // 5. æ£€æŸ¥ API é…ç½®
            output += '\n5ï¸âƒ£ æ£€æŸ¥ API é…ç½®...\n';
            try {
                // å°è¯•ä» blog.js ä¸­è·å–é…ç½®ï¼ˆå¦‚æœå·²åŠ è½½ï¼‰
                if (typeof BLOG_API_URL !== 'undefined') {
                    output += '   API URL é…ç½®: ' + BLOG_API_URL + '\n';
                } else {
                    output += '   âš ï¸ æ— æ³•è·å– API URL é…ç½®ï¼ˆblog.js å¯èƒ½æœªåŠ è½½ï¼‰\n';
                }
            } catch (e) {
                output += '   âš ï¸ æ— æ³•æ£€æŸ¥ API é…ç½®\n';
            }
            
            output += '\nâœ… è¯Šæ–­å®Œæˆï¼\n';
            output += '\nå¦‚æœ API è¿æ¥å¤±è´¥ï¼Œè¯·:\n';
            output += '1. æ£€æŸ¥ Vercel Dashboard ä¸­çš„ç¯å¢ƒå˜é‡é…ç½®\n';
            output += '2. æŸ¥çœ‹ Vercel Functions æ—¥å¿—\n';
            output += '3. ç¡®è®¤ GitHub Gist å’Œ Token é…ç½®æ­£ç¡®\n';
            
            resultDiv.textContent = output;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œè¯Šæ–­ï¼ˆå¯é€‰ï¼‰
        // window.addEventListener('load', () => {
        //     setTimeout(runDiagnosis, 1000);
        // });
    </script>
</body>
</html>

